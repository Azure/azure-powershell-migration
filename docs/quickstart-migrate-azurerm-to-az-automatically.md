---
title: Automatically migrate PowerShell scripts from AzureRM to the Az PowerShell module
description: Learn how to automatically migrate PowerShell scripts from AzureRM to the Az PowerShell module.
author: mikefrobbins
ms.service: azure-powershell
ms.topic: quickstart
ms.custom: devx-track-azurepowershell
ms.author: mirobb
ms.date: 07/29/2020
---

# Quickstart: Automatically migrate PowerShell scripts from AzureRM to the Az PowerShell module

In this article, you'll learn how to use the Az.Tools.Migration PowerShell module to automatically
upgrade your PowerShell scripts and script modules from AzureRM to the Az PowerShell module.

> [!IMPORTANT]
> The Az.Tools.Migration PowerShell module is currently in public preview. This preview version is
> provided without a service level agreement. It's not recommended for production workloads. Certain
> features might not be supported or might have constrained capabilities. For more information, see
> [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).

Report feedback and issues about the Az.Tools.Migration PowerShell module via
[a GitHub issue](https://github.com/Azure/azure-powershell-migration/issues) in the
`azure-powershell-migration` repository.

## Requirements

* Update your existing PowerShell scripts to the latest version of the [AzureRM PowerShell module (6.13.1)](https://github.com/Azure/azure-powershell/releases/tag/v6.13.1-November2018).
* Install the Az.Tools.Migration PowerShell module.

  ```powershell
  Install-Module -Name Az.Tools.Migration
  ```

## Find upgrade command references

Optionally, you can run the `Find-AzUpgradeCommandReference` command to search for AzureRM command
references in a specific file or folder.

When `Find-AzUpgradeCommandReference` searches through the specified file or folder, cmdlets used in
the files are analyzed and compared against known AzureRM PowerShell commands. The following example
returns the position and offset of each AzureRM cmdlet usage in the specified file or folder.

```powershell
# Find AzureRM PowerShell command references in the specified file.
Find-AzUpgradeCommandReference -FilePath 'C:\Scripts\test.ps1' -AzureRmVersion '6.13.1'

# Find AzureRM PowerShell command references in the specified directory and subfolders.
Find-AzUpgradeCommandReference -DirectoryPath 'C:\Scripts' -AzureRmVersion '6.13.1'
```

The output of `Find-AzUpgradeCommandReference` can be passed as a parameter to `New-AzUpgradeModulePlan` to
generate a detailed list of required upgrade changes.

## Generate an upgrade plan

You use the `New-AzUpgradeModulePlan` cmdlet to generate an upgrade plan for migrating your scripts
and modules to the Az PowerShell module. The upgrade plan details the specific file and offset
points that require changes when moving from AzureRM to the Az PowerShell cmdlets.

> [!NOTE]
> The `New-AzUpgradeModulePlan` cmdlet doesn't execute the plan, it only generates the upgrade steps.

```powershell
#  Generate an upgrade plan for the specified PowerShell script and save it to a variable.
$Plan = New-AzUpgradeModulePlan -FromAzureRmVersion 6.13.1 -ToAzVersion 4.4.0 -FilePath 'C:\Scripts\my-azure-script.ps1'
```

```powershell
# Generate an upgrade plan for the script and module files in the specified folder and save it to a variable.
$Plan = New-AzUpgradeModulePlan -FromAzureRmVersion 6.13.1 -ToAzVersion 4.4.0 -DirectoryPath 'C:\Scripts'
```

Review the results of the upgrade plan.

```powershell
# shows the entire upgrade plan
$Plan
```

Run the following command to filter the results to commands that have warnings or errors. This may be helpful on large result sets to quickly identify errors before the upgrade.

```powershell
# filter plan result to only show warnings and errors
$Plan | where PlanResult -ne ReadyToUpgrade | format-list
```

## Perform the upgrade

> [!CAUTION]
> There is no undo operation. Always ensure that you have a backup copy of your PowerShell scripts
> and modules that you're attempting to upgrade.

The upgrade plan is executed when you run the `Invoke-AzUpgradeModulePlan` cmdlet. This command
performs an in-place upgrade of the specified file or folders except for any errors
that were identified by the `New-AzUpgradeModulePlan` cmdlet.

> [!WARNING] The `Invoke-AzUpgradeModulePlan` cmdlet is destructive! It modifies your scripts and
> functions according to the module upgrade plan generated by the `New-AzUpgradeModulePlan` cmdlet.

```powershell
# run the automatic upgrade plan and save the results to a variable.
$Results = Invoke-AzUpgradeModulePlan -Plan $Plan
```

Review the results of the upgrade operation.

```powershell
# shows the entire upgrade operation result
$Results
```

If any errors are returned, you can take a closer look at the error results with the following command:

```powershell
# filter results to show errors
$Results | where UpgradeResult -ne UpgradeCompleted | format-list
```

## Limitations

* Automated parameter name updates to splatted parameter sets aren't supported. If any are found
  during upgrade plan generation, a warning is returned.
* File I/O operations use default encoding. Unusual file encoding situations may cause problems.
* AzureRM cmdlets passed as arguments to Pester unit test mock statements aren't detected.
* Currently, only Az PowerShell module version 4.4.0 is supported as a target.

## Next steps

To learn more about the Az PowerShell module, see the [Azure PowerShell documentation](https://docs.microsoft.com/powershell/azure/)